"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var n=Object.getOwnPropertyDescriptor(t,o);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,n)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const node_server_1=require("@hono/node-server"),hono_1=require("hono"),node_telegram_bot_api_1=__importDefault(require("node-telegram-bot-api")),dotenv=__importStar(require("dotenv")),sharp_1=__importDefault(require("sharp")),constants_1=require("./constants");dotenv.config();const port=3e3,token=process.env.TOKEN,app=new hono_1.Hono,bot=new node_telegram_bot_api_1.default(token,{polling:!0});let chosenFormat="";const sendFormatSelection=e=>{bot.sendMessage(e,constants_1.arabicLanguage.chooseFormat,{reply_markup:{inline_keyboard:constants_1.supportedFormats.map((e=>[{text:e.toUpperCase(),callback_data:e}]))}})};bot.on("text",(e=>{const t=e.chat.id;sendFormatSelection(t),chosenFormat=""})),bot.onText(/\/help/,(e=>{const t=e.chat.id;bot.sendMessage(t,constants_1.arabicLanguage.help)})),bot.on("callback_query",(e=>{const t=e.message;chosenFormat=e.data,bot.sendMessage(t.chat.id,`Ø§Ø®ØªØ±Øª ${null==chosenFormat?void 0:chosenFormat.toUpperCase()} âœ…\nØ§Ø±Ø³Ù„ Ø§Ù„ØµÙˆØ±Ø© ğŸ“·`)})),bot.on("photo",(async e=>{var t,o;const r=e.chat.id;if(!chosenFormat)return bot.sendMessage(r,"Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙŠØºØ© Ø£ÙˆÙ„Ø§ â—ï¸"),void sendFormatSelection(r);bot.sendMessage(r,`Ù†Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØºÙŠÙŠØ± ØµÙˆØ±ØªÙƒ Ø¥Ù„Ù‰ ${chosenFormat.toUpperCase()} \n Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§ â³`);const n=null===(o=null===(t=e.photo)||void 0===t?void 0:t[e.photo.length-1])||void 0===o?void 0:o.file_id;try{const e=await bot.getFileLink(n),t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch image (${t.status} ${t.statusText})`);const o=await t.arrayBuffer(),a=Buffer.from(o),s=chosenFormat,i=await(0,sharp_1.default)(a).toFormat(s,{quality:100}).toBuffer();bot.sendDocument(r,i),bot.sendMessage(r,`ØªÙØ¶Ù„ ØµÙˆØ±ØªÙƒ Ø¨ØµÙŠØºØ© ${chosenFormat.toUpperCase()} ğŸ–¼ï¸\nÙ„Ùˆ Ø§Ø­ØªØ¬Øª Ø´ÙŠØ¦Ø§ Ø¢Ø®Ø± ÙØ£Ø±Ø³Ù„ Ù†Ù‚Ø·Ø©\nÙ„Ù„ØªÙˆØ§ØµÙ„: x.com/alwalxed`),chosenFormat=""}catch(e){bot.sendMessage(r,"An error occurred while converting your image. Please try again."),console.error("Error converting image:",e)}})),(0,node_server_1.serve)({fetch:app.fetch,port:3e3}),console.log("Server is running on port 3000");